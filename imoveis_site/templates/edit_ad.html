{% extends 'base.html' %}

{% block title %}Editar An√∫ncio - Site de Im√≥veis{% endblock %}

{% block content %}
<div class="form-container">
    <!-- Cabe√ßalho -->
    <div style="text-align: center; margin-bottom: 2rem;">
        <h2 style="color: var(--cor-destaque); font-size: 2rem; margin-bottom: 0.5rem;">
            ‚úèÔ∏è Editar An√∫ncio
        </h2>
        <p style="color: var(--cor-texto);">
            Atualize as informa√ß√µes do seu im√≥vel
        </p>
        
        <!-- Informa√ß√µes do an√∫ncio atual -->
        <div style="background: var(--cor-info); padding: 1rem; border-radius: 6px; margin-top: 1rem;">
            <strong>Editando:</strong> {{ ad.title }}
        </div>
    </div>

    <!-- Formul√°rio -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Usar form.as_p estilizado ou campos individuais -->
        {% if form.title %}
            <!-- T√≠tulo -->
            <div class="form-group">
                <label for="{{ form.title.id_for_label }}">
                    üè† T√≠tulo do An√∫ncio <span style="color: #dc3545;">*</span>
                </label>
                {{ form.title }}
                {% if form.title.help_text %}
                    <small style="color: var(--cor-destaque); font-size: 0.9rem;">
                        {{ form.title.help_text }}
                    </small>
                {% endif %}
                {% if form.title.errors %}
                    {% for error in form.title.errors %}
                        <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                            {{ error }}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        {% endif %}

        {% if form.category %}
            <!-- Categoria -->
            <div class="form-group">
                <label for="{{ form.category.id_for_label }}">
                    üìÇ Tipo de Im√≥vel <span style="color: #dc3545;">*</span>
                </label>
                {{ form.category }}
                {% if form.category.errors %}
                    {% for error in form.category.errors %}
                        <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                            {{ error }}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        {% endif %}

        <!-- Pre√ßo e Local na mesma linha -->
        <div class="row">
            {% if form.price %}
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="{{ form.price.id_for_label }}">
                            üí∞ Pre√ßo Mensal (R$) <span style="color: #dc3545;">*</span>
                        </label>
                        {{ form.price }}
                        {% if form.price.errors %}
                            {% for error in form.price.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ error }}
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
            
            {% if form.location %}
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="{{ form.location.id_for_label }}">
                            üìç Localiza√ß√£o <span style="color: #dc3545;">*</span>
                        </label>
                        {{ form.location }}
                        {% if form.location.errors %}
                            {% for error in form.location.errors %}
                                <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                                    {{ error }}
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>

        {% if form.description %}
            <!-- Descri√ß√£o -->
            <div class="form-group">
                <label for="{{ form.description.id_for_label }}">
                    üìÑ Descri√ß√£o Detalhada
                </label>
                {{ form.description }}
                {% if form.description.errors %}
                    {% for error in form.description.errors %}
                        <div style="color: #dc3545; font-size: 0.9rem; margin-top: 0.25rem;">
                            {{ error }}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        {% endif %}

        {% if form.image %}
            <!-- Upload de Imagem -->
            <div class="form-group">
                <label for="{{ form.image.id_for_label }}">
                    üì∏ Foto do Im√≥vel
                </label>
                {{ form.image }}
                {% if ad.image %}
                    <div style="margin-top: 0.5rem;">
                        <small style="color: var(--cor-destaque);">
                            Foto atual: {{ ad.image.name|truncatechars:30 }}
                        </small>
                    </div>
                {% endif %}
                <small style="color: var(--cor-destaque); font-size: 0.9rem; display: block; margin-top: 0.25rem;">
                    Deixe em branco para manter a foto atual
                </small>
            </div>
        {% endif %}

        <!-- Se existirem campos n√£o cobertos acima, mostrar todos -->
        {% if not form.title and not form.category %}
            <div style="background: var(--cor-primaria); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                {{ form.as_p }}
            </div>
        {% endif %}

        <!-- Informa√ß√µes sobre √∫ltima edi√ß√£o -->
        <div style="background: var(--cor-warning); padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
            <h4 style="color: var(--cor-destaque); margin-bottom: 0.5rem; font-size: 1.1rem;">
                ‚ÑπÔ∏è Informa√ß√µes da Edi√ß√£o:
            </h4>
            <p style="margin: 0; color: var(--cor-texto); font-size: 0.9rem;">
                ‚Ä¢ An√∫ncio criado em: {{ ad.created_at|date:"d/m/Y √†s H:i" }}<br>
                ‚Ä¢ √öltima modifica√ß√£o: {{ ad.updated_at|date:"d/m/Y √†s H:i" }}<br>
                ‚Ä¢ Suas altera√ß√µes ser√£o salvas imediatamente
            </p>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <button type="submit" class="btn btn-success" style="min-width: 150px;">
                ‚úÖ Salvar Altera√ß√µes
            </button>
            <a href="{% url 'index' %}" class="btn btn-secondary" style="min-width: 150px;">
                üëÅÔ∏è Ver An√∫ncios
            </a>
            <a href="{% url 'delete_ad' ad.id %}" class="btn btn-danger" style="min-width: 150px;">
                üóëÔ∏è Excluir An√∫ncio
            </a>
        </div>
    </form>
</div>

<!-- Script para melhorar UX -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Adiciona classe form-control aos campos gerados pelo Django
    const inputs = document.querySelectorAll('input, select, textarea');
    inputs.forEach(function(input) {
        if (!input.classList.contains('form-control') && input.type !== 'submit') {
            input.classList.add('form-control');
        }
    });
    
    // Confirma√ß√£o antes de excluir
    const deleteBtn = document.querySelector('a.btn-danger');
    if (deleteBtn) {
        deleteBtn.addEventListener('click', function(e) {
            if (!confirm('Tem certeza que deseja excluir este an√∫ncio? Esta a√ß√£o n√£o pode ser desfeita.')) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}